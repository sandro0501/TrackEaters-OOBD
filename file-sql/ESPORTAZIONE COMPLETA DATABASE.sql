--FUNZIONI E PROCEDURE DEL DB
/*============================================================================================*/
/*============================================================================================*/
-- 1. Funzione IS_NUMBER il cui scopo è quello di verificare che una stringa inserita contenga solo caratteri numerici
CREATE FUNCTION IS_NUMBER (stringa IN VARCHAR2) RETURN INT
IS
valorenumerico NUMBER;
BEGIN
	-- Converte da valore numerico a stringa e ritorna 1
	valorenumerico := TO_NUMBER(stringa);
	RETURN 1;
	
	-- Se fallisce la conversione, errore e ritorna 0
	EXCEPTION WHEN VALUE_ERROR THEN
	RETURN 0;
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- 2. Procedure Numero di telefono legale (viene riutilizzata più volte nei trigger) 
CREATE PROCEDURE NUMERO_DI_TELEFONO_LEGALE (numerotelefonico IN VARCHAR2) 
IS 
stringa VARCHAR2(15);
BEGIN

	-- Rimuove inizialmente tutti gli spazi, se presenti, dalla stringa del numero telefonico
	-- per effettuare il successivo controllo
    stringa := REPLACE(numerotelefonico,' ','');
	
	-- Se presente un prefisso nel numero telefonico con il carattere +, rimuove quest'ultimo
	-- per effettuare il successivo controllo 
	IF stringa LIKE '+%' THEN
		stringa := TRIM('+' FROM stringa);
	END IF;
	
	-- Controlla che i restanti caratteri associati al numero telefonico siano numeri. 
	-- Se il controllo fallisce, è presente un carattere diverso da un numero 
	-- quindi il numero di telefono non è valido.
	IF (is_number(stringa)=0) THEN
		RAISE_APPLICATION_ERROR(-20010,'Numero di telefono non valido.');
	END IF;
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- 3. Procedure Password legale (viene riutilizzata più volte nei trigger)
CREATE PROCEDURE PASSWORD_LEGALE (password IN VARCHAR2) 
IS 
password_okay INTEGER; 
BEGIN
	-- Controlla se la password contiene almeno una lettera ed un numero 
	IF REGEXP_LIKE(password,'^.*[A-Z].*$') AND REGEXP_LIKE(password,'^.*[0-9].*$') THEN
		password_okay := 1;
	ELSE
		password_okay := 0; -- La password non contiene almeno una lettera ed un numero 
	END IF;
	
	-- Se la password inserita è lunga meno di 8 caratteri o 
	-- non contiene almeno una lettera ed un numero allora non è valida
	IF (LENGTH(password) < 8) OR (password_okay = 0) THEN
		RAISE_APPLICATION_ERROR(-20011,'Password non valida. Deve contenere almeno 8 caratteri, una lettera ed un numero!');
	END IF;
END;
/
/*============================================================================================*/
/*============================================================================================*/

-- DEFINIZIONE DELLE TABELLE DB 
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella PROPRIETARIO
CREATE TABLE PROPRIETARIO
(
	CodProprietario	INTEGER	GENERATED BY DEFAULT AS IDENTITY,
	Username		VARCHAR2(64)  NOT NULL,	
	Password 		VARCHAR2(64)  NOT NULL,
	Nome			VARCHAR2(64)  NOT NULL,
	Cognome			VARCHAR2(64)  NOT NULL,
	Email			VARCHAR2(320)   
);
/
-- Definizione dei vincoli per la tabella PROPRIETARIO
ALTER TABLE PROPRIETARIO ADD
(
	-- Vincolo di chiave primaria
	CONSTRAINT PK_PROPRIETARIO PRIMARY KEY (CodProprietario),
	
	-- Vincolo Email legale
	CONSTRAINT EMAIL_LEGALE_PROPRIETARIO CHECK (Email LIKE '_%@_%.__%' OR Email IS NULL),
	
	-- Vincolo Unico username proprietario
	CONSTRAINT UNICO_USERNAME_PROPRIETARIO UNIQUE (Username)
);
/
-- Trigger per il vincolo Password legale 
CREATE OR REPLACE TRIGGER PASSWORD_PROPRIETARIO_LEGALE
BEFORE INSERT OR UPDATE ON PROPRIETARIO
FOR EACH ROW
BEGIN
	PASSWORD_LEGALE(:NEW.Password);
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella RISTORANTE
CREATE TABLE RISTORANTE
(
	CodRistorante	INTEGER	GENERATED BY DEFAULT AS IDENTITY,
	Denominazione	VARCHAR2(64)  	NOT NULL,	
	Indirizzo 		VARCHAR2(64)  	NOT NULL,
	Telefono		VARCHAR2(20)  	NOT NULL,
	Citta			VARCHAR2(64)  	NOT NULL,
	Prov			VARCHAR2(2)   	NOT NULL,
	Cap				VARCHAR2(5)		NOT NULL,
	Email			VARCHAR2(320)			,  
	SitoWeb			VARCHAR2(100)			, 
	Proprietario	INTEGER		  	NOT NULL
);
/
-- Definizione dei vincoli per la tabella RISTORANTE
ALTER TABLE RISTORANTE ADD
(
	-- Vincolo di chiave primaria
	CONSTRAINT PK_RISTORANTE PRIMARY KEY (CodRistorante),
	
	-- Vincolo di chiave esterna
	/*Non sarà possibile eliminare un proprietario a cui sono associati uno o più ristoranti
	ON DELETE NO ACTION è implementato di default da ORACLE*/ 
	CONSTRAINT FK_PROPRIETARIO_RISTORANTE FOREIGN KEY (Proprietario) REFERENCES PROPRIETARIO(CodProprietario),
	
	-- Vincolo Email legale
	CONSTRAINT EMAIL_LEGALE_RISTORANTE CHECK (Email LIKE '_%@_%.__%' OR Email IS NULL),
	
	-- Vincolo Sito Web Legale
	CONSTRAINT SITO_WEB_LEGALE CHECK (SitoWeb LIKE 'www.__%._%' OR SitoWeb IS NULL)
);
/
-- Trigger per il vincolo Numero di telefono legale 
CREATE OR REPLACE TRIGGER NUMERO_DI_TELEFONO_RISTORANTE_LEGALE
BEFORE INSERT OR UPDATE ON RISTORANTE
FOR EACH ROW
BEGIN
	NUMERO_DI_TELEFONO_LEGALE(:NEW.Telefono);
END;
/
-- Trigger per il vincolo Cap legale
CREATE OR REPLACE TRIGGER CAP_LEGALE
BEFORE INSERT OR UPDATE ON RISTORANTE
FOR EACH ROW
BEGIN
	-- Controlla che i caratteri associati al CAP inserito siano 5 e tutti numeri. 
	-- Se il controllo fallisce, quindi è presente un carattere diverso da un numero oppure
	-- ci sono meno di 5 caratteri allora il CAP non è valido.
	IF (is_number(:NEW.Cap)=0) OR (LENGTH(:NEW.Cap)<5) THEN
		RAISE_APPLICATION_ERROR(-20012,'CAP inserito non valido.');
	END IF;
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella MANAGERRISTORANTE
CREATE TABLE MANAGERRISTORANTE
(
	CodManager			INTEGER GENERATED BY DEFAULT AS IDENTITY,
	Username			VARCHAR2(64)  NOT NULL,	
	Password 			VARCHAR2(64)  NOT NULL,
	Nome				VARCHAR2(64)  NOT NULL,
	Cognome				VARCHAR2(64)  NOT NULL,
	Email				VARCHAR2(320)		  ,
	Telefono			VARCHAR2(20)  NOT NULL,
	RistoranteGestito	INTEGER 	  		  
);
/
-- Definizione dei vincoli per la tabella MANAGERRISTORANTE
ALTER TABLE MANAGERRISTORANTE ADD
(
	-- Vincolo di chiave primaria
	CONSTRAINT PK_MANAGER_RISTORANTE PRIMARY KEY (CodManager),
	
	-- Vincolo di chiave esterna
	-- Se si cancella un ristorante vengono eliminati anche i manager che lo gestiscono 
	CONSTRAINT FK_MANAGER_RISTORANTE FOREIGN KEY (RistoranteGestito) REFERENCES RISTORANTE(CodRistorante) ON DELETE CASCADE,
	
	-- Vincolo Email legale
	CONSTRAINT EMAIL_LEGALE_MANAGER_RISTORANTE CHECK (Email LIKE '_%@_%.__%' OR Email IS NULL),
	
	-- Vincolo Unico username manager
	CONSTRAINT UNICO_USERNAME_MANAGER_RISTORANTE UNIQUE (Username)
);
/
-- Trigger per il vincolo Password legale
CREATE OR REPLACE TRIGGER PASSWORD_MANAGER_RISTORANTE_LEGALE
BEFORE INSERT OR UPDATE ON MANAGERRISTORANTE
FOR EACH ROW
BEGIN
	PASSWORD_LEGALE(:NEW.Password);
END;
/
-- Trigger per il vincolo Numero di telefono legale 
CREATE OR REPLACE TRIGGER NUMERO_DI_TELEFONO_MANAGER_RISTORANTE_LEGALE
BEFORE INSERT OR UPDATE ON MANAGERRISTORANTE
FOR EACH ROW
BEGIN
	NUMERO_DI_TELEFONO_LEGALE(:NEW.Telefono);
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella SALA
CREATE TABLE SALA
(
    CodSala				INTEGER GENERATED BY DEFAULT AS IDENTITY,
    Denominazione       VARCHAR2(64)    NOT NULL,
    CapienzaAvventori   INTEGER			NOT NULL,
    DimensioneMq        INTEGER		 			,
    TipoSala            VARCHAR(10)		NOT NULL,
    Ristorante        	INTEGER         NOT NULL   
);
/
-- Definizione dei vincoli per la tabella SALA
ALTER TABLE SALA ADD
(
    -- Vincolo di chiave primaria
    CONSTRAINT PK_SALA PRIMARY KEY (CodSala),
    
    -- Vincolo di chiave esterna
	-- Se si cancella un ristorante vengono eliminate anche le sale che vi appartengono
    CONSTRAINT FK_SALA_RISTORANTE FOREIGN KEY (Ristorante) REFERENCES RISTORANTE(CodRistorante) ON DELETE CASCADE,
	
	-- Vincolo CapienzaAvventori legale 
	CONSTRAINT CAPIENZAAVVENTORI_LEGALE CHECK (CapienzaAvventori>0),
	
	-- Vincolo DimensioneMq legale 
	CONSTRAINT DIMENSIONEMQ_LEGALE CHECK (DimensioneMq>0 OR DimensioneMq IS NULL),
	
	-- Vincolo TSala
	CONSTRAINT TSALA CHECK (TipoSala IN ('Interna','Esterna'))	
);
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella CAMERIERE
CREATE TABLE CAMERIERE
(
    NumCid              VARCHAR2(9)		NOT NULL,
    Nome                VARCHAR2(64)	NOT NULL,
    Cognome             VARCHAR2(64)	NOT NULL,
    DataN               DATE			NOT NULL,
    Sesso               VARCHAR2(20)	NOT NULL,
    CittaN              VARCHAR2(64)	NOT NULL,
    ProvN               VARCHAR2(2)		NOT NULL,
    CittaRes            VARCHAR2(64)	NOT NULL,
    ProvRes             VARCHAR2(2)		NOT NULL,
    Telefono            VARCHAR2(20)	NOT NULL,
    Email               VARCHAR2(320)			,
    Ristorante          INTEGER			NOT NULL  
);
/
-- Definizione dei vincoli per la tabella CAMERIERE
ALTER TABLE CAMERIERE ADD
(
	-- Vincolo di chiave primaria
	CONSTRAINT PK_CAMERIERE PRIMARY KEY (NumCid),
	
	-- Vincolo di chiave esterna
	-- Se si cancella un ristorante vengono eliminate anche i camerieri che vi lavorano
	CONSTRAINT FK_CAMERIERE_RISTORANTE FOREIGN KEY (Ristorante) REFERENCES RISTORANTE(CodRistorante) ON DELETE CASCADE,
	
	-- Vincolo Email legale
	CONSTRAINT EMAIL_LEGALE_CAMERIERE CHECK (Email LIKE '_%@_%.__%' OR Email IS NULL),
	
	-- Vincolo TSesso
	CONSTRAINT TSesso CHECK (Sesso IN ('Maschio','Femmina','Non specificato'))	
);
/
-- Trigger per il vincolo Numero di telefono legale 
CREATE OR REPLACE TRIGGER NUMERO_DI_TELEFONO_CAMERIERE_LEGALE
BEFORE INSERT OR UPDATE ON CAMERIERE
FOR EACH ROW
BEGIN
	NUMERO_DI_TELEFONO_LEGALE(:NEW.Telefono);
END;
/
-- Trigger per il vincolo Età cameriere legale
CREATE OR REPLACE TRIGGER ETA_CAMERIERE_LEGALE
BEFORE INSERT OR UPDATE ON CAMERIERE
FOR EACH ROW
DECLARE etacameriere INTEGER;
BEGIN
	-- Se l'età del cameriere è inferiore a 18 anni, 
	-- allora non sarà possibile inserire il cameriere 
	etacameriere := TRUNC((TO_NUMBER(SYSDATE - :NEW.DataN))/365.25); 
	
	IF etacameriere < 18 THEN 
		RAISE_APPLICATION_ERROR(-20014,'DataN per cameriere non valida. Un cameriere deve essere maggiorenne!');
	END IF; 
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella Tavolo
CREATE TABLE TAVOLO
(
    CodTavolo 		INTEGER GENERATED BY DEFAULT AS IDENTITY,
    MaxAvventori    INTEGER		NOT NULL,
    Sala            INTEGER		NOT NULL,
    TavoloAdiacente INTEGER     
);
/
-- Definizione dei vincoli per la tabella TAVOLO
ALTER TABLE TAVOLO ADD
(
    -- Vincolo di chiave primaria
    CONSTRAINT PK_TAVOLO PRIMARY KEY (CodTavolo),
    
    -- Vincolo di chiave esterna
	-- Se si cancella una sala vengono eliminati anche i tavoli in essa contenuti
    CONSTRAINT FK_SALA_TAVOLO FOREIGN KEY (Sala) REFERENCES SALA(CodSala) ON DELETE CASCADE,
    
    -- Vincolo di chiave esterna
	-- Se si cancella un tavolo adiacente ad un altro, l'adiacenza diventa NULL 
    CONSTRAINT FK_TAVOLO_ADIACENTE FOREIGN KEY (TavoloAdiacente) REFERENCES TAVOLO(CodTavolo) ON DELETE SET NULL
);
/
-- Trigger per il vincolo MaxAvventori legale 
CREATE OR REPLACE TRIGGER MAXAVVENTORI_LEGALE
AFTER INSERT OR UPDATE ON TAVOLO
FOR EACH ROW 
DECLARE
capienza INTEGER;
BEGIN
	-- Calcolo di CapienzaAvventori 
	SELECT S.CapienzaAvventori INTO capienza
	FROM SALA S 
	WHERE S.CodSala = :NEW.Sala;

	-- Se MaxAvventori è <=0 allora non è valido 
	IF :NEW.MaxAvventori <=0 THEN
		RAISE_APPLICATION_ERROR(-20015,'Il valore per MaxAvventori deve essere maggiore di 0!');
	ELSE 
		-- Se MaxAvventori è > di CapienzaAvventori della sala in cui il tavolo è contenuto
		-- allora non è valido 
		IF :NEW.MaxAvventori > capienza THEN 
			RAISE_APPLICATION_ERROR(-20016,'Il valore di MaxAvventori per il tavolo deve essere 
			minore o uguale alla CapienzaAvventori della sala che contiene il tavolo in questione!');
		END IF;
	END IF; 
END;
/
-- Trigger per il vincolo Capienza legale 
CREATE OR REPLACE TRIGGER CAPIENZA_LEGALE
BEFORE INSERT ON TAVOLO
FOR EACH ROW
DECLARE
capienza INTEGER;
capienzacorrente INTEGER;
BEGIN
	-- Calcolo di CapienzaAvventori 
	SELECT S.CapienzaAvventori INTO capienza
	FROM SALA S 
	WHERE S.CodSala = :NEW.Sala;
	
	-- Calcolo della CapienzaAvventori corrente per la Sala 
	SELECT SUM(T.MAXAVVENTORI) INTO capienzacorrente
	FROM TAVOLO T
	WHERE T.Sala =:NEW.Sala;
	
	-- Se la somma fra la Capienza corrente e il nuovo MaxAvventori supera 
	-- la Capienza massima della Sala allora blocca l'inserimento
	IF :NEW.MAXAVVENTORI+capienzacorrente > capienza THEN
		RAISE_APPLICATION_ERROR(-20017,'Errore. Capienza massima della sala di riferimento superata!');
	END IF;
	
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella TAVOLATA
CREATE TABLE TAVOLATA
(
    CodTavolata		INTEGER GENERATED BY DEFAULT AS IDENTITY,
    DataArrivo      DATE        					DEFAULT SYSDATE NOT NULL,
    OraArrivo       INTERVAL DAY(0) TO SECOND(0)	DEFAULT INTERVAL '20:00' HOUR TO MINUTE	 NOT NULL,
    OraUsicta       INTERVAL DAY(0) TO SECOND(0)	DEFAULT INTERVAL '22:00' HOUR TO MINUTE	 NOT NULL,
    Tavolo          INTEGER     					NOT NULL,
    Cameriere       VARCHAR2(9)    					NOT NULL  
);
/
-- Definizione dei vincoli per la tabella TAVOLATA
ALTER TABLE TAVOLATA ADD
(
	-- Vincolo di chiave primaria
    CONSTRAINT PK_TAVOLATA PRIMARY KEY (CodTavolata),
    
	-- Vincolo di chiave esterna
	-- Se si elimina un tavolo viene eliminata anche la tavolata ad esso associato 
	CONSTRAINT FK_TAVOLO_TAVOLATA FOREIGN KEY (Tavolo) REFERENCES TAVOLO(CodTavolo) ON DELETE CASCADE,
    
	-- Vincolo di chiave esterna
	CONSTRAINT FK_CAMERIERE_TAVOLATA FOREIGN KEY (Cameriere) REFERENCES CAMERIERE(NumCid),
   
	-- Vincolo Unica composizione tavolo a tavolata 
	CONSTRAINT UNICA_COMPOSIZIONE_TAVOLO_A_TAVOLATA UNIQUE(DataArrivo,Tavolo)
);
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella AVVENTORE
CREATE TABLE AVVENTORE
(
    NumCid              VARCHAR2(9)		NOT NULL,
    Nome                VARCHAR2(64)	NOT NULL,
    Cognome             VARCHAR2(64)	NOT NULL,
    DataN               DATE			NOT NULL,
    Sesso               VARCHAR2(15)	NOT NULL,
    CittaN              VARCHAR2(64)	NOT NULL,
    ProvN               VARCHAR2(2)		NOT NULL,
    CittaRes            VARCHAR2(64)	NOT NULL,
    ProvRes             VARCHAR2(2)		NOT NULL,
    Telefono            VARCHAR2(20)    NOT NULL,
    Email               VARCHAR2(320)			,
    Temperatura         DECIMAL(3,1)	NOT NULL,
    HaGreenpass         CHAR          	DEFAULT 'F' NOT NULL,
    Ristorante          INTEGER			NOT NULL,
    Tavolata            INTEGER         NOT NULL
);
/
-- Definizione dei vincoli per la tabella AVVENTORE
ALTER TABLE AVVENTORE ADD
(
	-- Vincolo di chiave primaria
    CONSTRAINT PK_AVVENTORE PRIMARY KEY (NumCid),
	
    -- Vincolo di chiave esterna
	-- Se si elimina un ristorante vengono eliminati anche gli avventori da esso accolti
    CONSTRAINT FK_AVVENTORE_RISTORANTE FOREIGN KEY (Ristorante) REFERENCES RISTORANTE(CodRistorante) ON DELETE CASCADE,
    
	-- Vincolo di chiave esterna
	-- Se si elimina una tavolata vengono  eliminati anche gli avventori che la formano 
	CONSTRAINT FK_AVVENTORE_TAVOLATA FOREIGN KEY (Tavolata) REFERENCES TAVOLATA(CodTavolata) ON DELETE CASCADE,
	
	-- Vincolo Email legale
	CONSTRAINT EMAIL_LEGALE_AVVENTORE CHECK (Email LIKE '_%@_%.__%' OR Email IS NULL),
	
	-- Vincolo TSesso
	CONSTRAINT TSesso_AVVENTORE CHECK (Sesso IN ('Maschio','Femmina','Non specificato')),	
	
	-- Vincolo per il dominio dell'attributo booleano HaGreenPass
	CONSTRAINT HAGREENPASS_VALUES CHECK (HaGreenPass IN('V','F')),
	
	-- Vincolo Temperatura avventore legale 
	CONSTRAINT TEMPERATURA_AVVENTORE_LEGALE CHECK (Temperatura BETWEEN 35.0 AND 37.5)	
);
/
-- Trigger per il vincolo Data nascita legale 
CREATE OR REPLACE TRIGGER DATA_NASCITA_LEGALE
BEFORE INSERT OR UPDATE ON AVVENTORE
FOR EACH ROW
DECLARE
datatavolata TAVOLATA.DataArrivo%TYPE; 
BEGIN
	-- Recupera la data della tavolata a cui partecipa l'avventore 
	SELECT T.DataArrivo INTO datatavolata
	FROM TAVOLATA T 
	WHERE T.CodTavolata = :NEW.Tavolata;
	
	-- Se la data di nascita dell'avventore è successiva alla data della tavolata allora
	-- blocca l'inserimento dell'avventore 
	IF :NEW.DataN > datatavolata THEN 
		RAISE_APPLICATION_ERROR( -20018, 'La data di nascita di un avventore deve essere precedente alla data di arrivo della tavolata!');
	END IF;
END;
/
-- Trigger per il vincolo Numero di telefono legale 
CREATE OR REPLACE TRIGGER NUMERO_DI_TELEFONO_AVVENTORE_LEGALE
BEFORE INSERT OR UPDATE ON AVVENTORE
FOR EACH ROW
BEGIN
	NUMERO_DI_TELEFONO_LEGALE(:NEW.Telefono);
END;
/
-- Trigger per il vincolo Has greenpass  
CREATE OR REPLACE TRIGGER HAS_GREENPASS
BEFORE INSERT OR UPDATE ON AVVENTORE
FOR EACH ROW
DECLARE 
tipologiasala SALA.TipoSala%TYPE;
BEGIN
	
	-- Recupera la tipologia della sala in cui è ubicato il tavolo della tavolata a cui partecipa l'avventore 
	SELECT S.TipoSala INTO tipologiasala
	FROM TAVOLATA T JOIN TAVOLO TA ON T.Tavolo = TA.CodTavolo JOIN SALA S ON S.CodSala = TA.Sala
	WHERE T.CodTavolata = :NEW.Tavolata;
	
	-- Se l'avventore è sprovvisto di green pass ed è stato associato ad una tavolata il cui tavolo 
	-- si trova in una sala interna allora non può partecipare alla tavolata. 
	IF :NEW.HaGreenpass='F' AND tipologiasala='Interna' THEN 
		RAISE_APPLICATION_ERROR( -20019, 'Un avventore sprovvisto di green pass puo partecipare unicamente
		ad una tavolata composta da un tavolo ubicato in una sala esterna!');
	END IF;
END;
/
-- Trigger per il vincolo Temperatura avventore legale
CREATE OR REPLACE TRIGGER TEMPERATURA_AVVENTORE
BEFORE INSERT OR UPDATE ON AVVENTORE
FOR EACH ROW
BEGIN
	-- Se la temperatura dell'avventore supera i 37.5 gradi allora comunica che l'avventore 
	-- puo' essere un potenziale caso da registrare nella tabella CASO. 
	IF :NEW.Temperatura > 37.5 THEN 
		RAISE_APPLICATION_ERROR( -20020, 'Temperatura avventore illegale! Potrebbe essere un potenziale CASO da registrare.');
	END IF;
END;
/
-- Trigger per il vincolo Somma avventori a tavolata legale 
CREATE OR REPLACE TRIGGER SOMMA_AVVENTORI_A_TAVOLATA_LEGALE
BEFORE INSERT ON AVVENTORE
FOR EACH ROW
DECLARE 
maxavventoritavolata TAVOLO.MaxAvventori%TYPE;
numavventoricorrente INTEGER; 
avventorecorrente INTEGER;
BEGIN
	-- Recupera il massimo numero dei posti del tavolo associato alla tavolata 
	SELECT TA.MaxAvventori INTO maxavventoritavolata
	FROM TAVOLATA T JOIN TAVOLO TA ON T.Tavolo = TA.CodTavolo
	WHERE T.CodTavolata = :NEW.Tavolata;
    
	-- Conta gli avventori correnti che partecipano alla tavolata 
	SELECT COUNT(A.NumCid) INTO numavventoricorrente
	FROM AVVENTORE A 
	WHERE A.Tavolata = :NEW.Tavolata;

	-- Se il numero di avventori correnti che partecipano alla tavolata 
	-- più il nuovo avventore che si sta per registrare 
	-- superano complessivamente il numero dei posti del tavolo 
	-- allora non è possibile registrare il nuovo avventore 
	IF numavventoricorrente+1 > maxavventoritavolata THEN 
		RAISE_APPLICATION_ERROR( -20021, 'Impossibile registrare avventore alla tavolata. 
		Il tavolo di riferimento ha tutti i posti occupati!');
	END IF;
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della tabella CASO
CREATE TABLE CASO
(
	CodCaso	INTEGER GENERATED BY DEFAULT AS IDENTITY,
    DataRegistrazione    DATE			NOT NULL,
    StatoCaso            VARCHAR2(20) 	DEFAULT 'NonRisolto' NOT NULL,
    Note                 VARCHAR2(100)	,
    AvventorePositivo    VARCHAR2(9)	,
    CamerierePositivo    VARCHAR2(9)	,
    RegistraProprietario INTEGER		,
    RegistraManager      INTEGER
);
/
-- Definizione dei vincoli per la tabella CASO
ALTER TABLE CASO ADD
(
    -- Vincolo di chiave primaria
    CONSTRAINT PK_CASO PRIMARY KEY (CodCaso),
    
    -- Vincolo di chiave esterna
    CONSTRAINT FK_AVVENTORE_POSITIVO FOREIGN KEY (AvventorePositivo) REFERENCES AVVENTORE(NumCid) ON DELETE SET NULL,
    
	-- Vincolo di chiave esterna
	CONSTRAINT FK_CAMERIERE_POSITIVO FOREIGN KEY (CamerierePositivo) REFERENCES CAMERIERE(NumCid) ON DELETE SET NULL,
   
	-- Vincolo di chiave esterna
	CONSTRAINT FK_REGISTRA_PROPRIETARIO FOREIGN KEY (RegistraProprietario) REFERENCES PROPRIETARIO(CodProprietario) ON DELETE SET NULL,
	
	-- Vincolo di chiave esterna
	CONSTRAINT FK_REGISTRA_MANAGER FOREIGN KEY (RegistraManager) REFERENCES MANAGERRISTORANTE(CodManager) ON DELETE SET NULL,
	
	-- Vincolo TCaso
	CONSTRAINT TCaso CHECK (StatoCaso IN ('Risolto','InRisoluzione','NonRisolto'))
);
/
-- Trigger per il vincolo Data registrazione caso 
CREATE OR REPLACE TRIGGER DATA_REGISTRAZIONE_CASO
BEFORE INSERT OR UPDATE ON CASO
FOR EACH ROW
DECLARE 
datanascita_avventore AVVENTORE.DataN%TYPE;
datanascita_cameriere CAMERIERE.DataN%TYPE;
BEGIN
	IF :NEW.AvventorePositivo IS NOT NULL  THEN 
		-- Recupera la data di nascita dell'avventore positivo 
		SELECT A.DataN INTO datanascita_avventore
		FROM AVVENTORE A 
		WHERE A.NumCid = :NEW.AvventorePositivo;
		
		-- Se la data di registrazione del caso precede la data di nascita
		-- allora non e' possibile registrare il caso 
		IF :NEW.DataRegistrazione < datanascita_avventore THEN 
				RAISE_APPLICATION_ERROR( -20022, 'Impossibile registrare caso: data registrazione non valida.');
		END IF; 	
	END IF; 


	IF :NEW.CamerierePositivo IS NOT NULL THEN 
		-- Recupera la data di nascita del cameriere positivo 
		SELECT C.DataN INTO datanascita_cameriere
		FROM CAMERIERE C 
		WHERE C.NumCid = :NEW.CamerierePositivo;
		
		-- Se la data di registrazione del caso precede la data di nascita
		-- allora non e' possibile registrare il caso 
		IF :NEW.DataRegistrazione < datanascita_cameriere THEN 
				RAISE_APPLICATION_ERROR( -20022, 'Impossibile registrare caso: data registrazione non valida.');
		END IF; 
	END IF; 	
END;
/
/*============================================================================================*/
/*============================================================================================*/
-- Creazione della VISTA 'Tavolate' : 
-- per ogni tavolata di un ristorante calcola il numero totale di partecipanti alla tavolata. 
CREATE VIEW TAVOLATE (Ristorante, CodiceTavolata, Partecipanti) AS
SELECT A.Ristorante, A.Tavolata, COUNT(A.NumCid) AS TOT_TAVOLATA
FROM AVVENTORE A JOIN TAVOLATA T ON A.Tavolata = T.CodTavolata
GROUP BY A.Ristorante, A.Tavolata
ORDER BY A.Tavolata ASC;
/
/*============================================================================================*/
/*============================================================================================*/

-- POPOLAMENTO TABELLE DEL DB 
/*============================================================================================*/
/*============================================================================================*/
-- Insert per la tabella PROPRIETARIO: aggiunge il proprietario dei ristoranti.
INSERT INTO PROPRIETARIO (CodProprietario, Username, Password, Nome, Cognome, Email)
VALUES (1,'sandro05','password00','Santolo','Barretta','santolobarretta05@gmail.com');
COMMIT;
/*============================================================================================*/
/*============================================================================================*/
-- Insert per la tabella RISTORANTE: aggiunge i ristoranti amministrati da un proprietario.
INSERT INTO RISTORANTE (CodRistorante, Denominazione, Indirizzo, Telefono, Citta, Prov, Cap, Email, SitoWeb, Proprietario)
VALUES (1,'Bella Napoli','Via Francesco Caracciolo, 1','0813509900','Napoli','NA','80122','bellanapoli@gmail.com','www.ristorantebellanapoli.it',1);

INSERT INTO RISTORANTE (CodRistorante, Denominazione, Indirizzo, Telefono, Citta, Prov, Cap, Email, SitoWeb, Proprietario)
VALUES (2,'Bella Napoli 2','Via Toledo, 30','0813339900','Napoli','NA','80134','bellanapoli@gmail.com','www.ristorantebellanapoli.it',1);

INSERT INTO RISTORANTE (CodRistorante, Denominazione, Indirizzo, Telefono, Citta, Prov, Cap, Proprietario)
VALUES (3,'La Madonnina','Via Alessandro Manzoni, 5','+390289091122','Milano','MI','20121',1);
COMMIT;
/*============================================================================================*/
/*============================================================================================*/
-- Insert per la tabella MANAGERRISTORANTE: aggiunge i manager che gestiscono un ristorante, se previsti.
INSERT INTO MANAGERRISTORANTE (CodManager, Username, Password, Nome, Cognome, Email, Telefono, RistoranteGestito)
VALUES (1,'angelo02','qwerty0123','Angelo','Di Maio','angelodimaio@gmail.com','+393337060999',2);

INSERT INTO MANAGERRISTORANTE (CodManager, Username, Password, Nome, Cognome, Telefono, RistoranteGestito)
VALUES (2,'mariorossi33','mr123456','Mario','Rossi','+393517799111',3);
COMMIT;
/*============================================================================================*/
/*============================================================================================*/
-- Insert per la tabella SALA: aggiunge le sale ai relativi ristoranti cui appartengono.
INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (1,'Sala Pulcinella',50,100,'Interna',1);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (2,'Sala Vesuvio',20,60,'Interna',1);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (3,'Sala Garden',10,30,'Esterna',1);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (4,'Sala Maradona',50,100,'Interna',2);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (5,'Sala Partenope',18,25,'Interna',2);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (6,'Sala Duomo',30,80,'Interna',3);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (7,'Sala Meneghino',30,80,'Interna',3);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (8,'Sala Biscione',20,60,'Interna',3);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (9,'Sala Exclusive',10,20,'Esterna',3);

INSERT INTO SALA (CodSala, Denominazione, CapienzaAvventori, DimensioneMq, TipoSala, Ristorante)
VALUES (10,'Sala Vip',10,NULL,'Esterna',3);
COMMIT;
/*============================================================================================*/
/*============================================================================================*/
-- Insert per la tabella CAMERIERE: aggiunge i camerieri ai rispettivi ristoranti per cui lavorano.
INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA78432DB','Ciro','Esposito',TO_DATE('08/01/2000','dd/mm/yyyy'),'Maschio','Napoli','NA','Qualiano','NA','3517486042','ciroespo@gmail.com',1);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA66421DA','Andrea','Russo',TO_DATE('10/10/1990','dd/mm/yyyy'),'Maschio','Villaricca','NA','Quarto','NA','3591676343','andrearusso@outlook.it',1);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('AU0199811','Maria','De Rosa',TO_DATE('22/03/1989','dd/mm/yyyy'),'Femmina','Pozzuoli','NA','Napoli','NA','3722282194','mariaderosa@gmail.com',1);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA64321CE','Rosaria','Romano',TO_DATE('30/08/1993','dd/mm/yyyy'),'Femmina','Napoli','NA','Napoli','NA','3218505681','romano01@gmail.com',1);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('AU3425442','Pasquale','Riccio',TO_DATE('12/04/1988','dd/mm/yyyy'),'Maschio','Caserta','CE','Casoria','NA','3273256337','ricciopas22@outlook.it',1);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA53216BE','Gabriele','Marino',TO_DATE('21/02/1993','dd/mm/yyyy'),'Maschio','Napoli','NA','Pozzuoli','NA','3553493696','marino0@gmail.com',2);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA73121FE','Salvatore','Neri',TO_DATE('12/03/1996','dd/mm/yyyy'),'Maschio','Napoli','NA','Bacoli','NA','3215642156','sasineri11@gmail.com',2);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('AU0567231','Luisa','Esposito',TO_DATE('08/01/2000','dd/mm/yyyy'),'Femmina','Napoli','NA','Quarto','NA','3445768683','espolui0@outlook.com',2);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA52131PV','Carmen','Granata',TO_DATE('28/05/1995','dd/mm/yyyy'),'Femmina','Marcianise','CE','Pozzuoli','NA','3830046533','carmen233@gmail.com',2);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA87452TB','Laura','Galli',TO_DATE('17/11/1999','dd/mm/yyyy'),'Femmina','Milano','MI','Legnano','MI','3746409289','lauragalli56@gmail.com',3);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA33145OD','Sara','Sala',TO_DATE('13/12/2000','dd/mm/yyyy'),'Femmina','Milano','MI','Sesto San Giovanni','MI','3227317200','sara123@gmail.com',3);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('AU0236754','Fiorella','Bianchi',TO_DATE('25/10/1990','dd/mm/yyyy'),'Femmina','Milano','MI','Rho','MI','3229731501','bianchi0@outlook.com',3);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA10946DE','Raffaele','Fontana',TO_DATE('04/09/1994','dd/mm/yyyy'),'Maschio','Milano','MI','Legnano','MI','3619439924','raffaele444@gmail.com',3);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA33241OA','Achille','Rinaldi',TO_DATE('21/05/1987','dd/mm/yyyy'),'Maschio','Milano','MI','Milano','MI','3283664283','achillerinaldi2@gmail.com',3);

INSERT INTO CAMERIERE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Ristorante)
VALUES ('CA13264UI','Morena','Costa',TO_DATE('19/03/1999','dd/mm/yyyy'),'Femmina','Milano','MI','Assago','MI','3194130484','morena43@outlook.com',3);
COMMIT;
/*============================================================================================*/
/*============================================================================================*/
-- Insert per la tabella TAVOLO
INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (1, 10, 1, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (2, 5, 1, 1);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (3, 5, 1, 2);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (4, 2, 1, 3);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (5, 2, 1, 4);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (6, 2, 1, 5);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (7, 2, 1, 6);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (8, 2, 1, 7);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (9, 20, 1, 8);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (10, 5, 2, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (11, 5, 2, 10);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (12, 2, 2, 11);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (13, 2, 2, 12);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (14, 2, 2, 13);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (15, 2, 2, 14);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (16, 2, 2, 15);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (17, 2, 3, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (18, 2, 3, 17);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (19, 2, 3, 18);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (20, 2, 3, 19);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (21, 2, 3, 20);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (22, 10, 4, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (23, 5, 4, 22);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (24, 5, 4, 23);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (25, 2, 4, 24);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (26, 2, 4, 25);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (27, 2, 4, 26);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (28, 2, 4, 27);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (29, 2, 4, 28);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (30, 20, 4, 29);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (31, 2, 5, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (32, 2, 5, 31);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (33, 4, 5, 32);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (34, 2, 5, 33);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (35, 2, 5, 34);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (36, 2, 5, 35);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (37, 4, 5, 36);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (38, 10, 6, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (39, 5, 6, 38);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (40, 5, 6, 39);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (41, 10, 6, 40);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (42, 10, 7, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (43, 5, 7, 42);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (44, 5, 7, 43);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (45, 10, 7, 44);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (46, 5, 8, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (47, 5, 8, 46);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (48, 2, 8, 47);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (49, 2, 8, 48);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (50, 2, 8, 49);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (51, 2, 8, 50);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (52, 2, 8, 51);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (53, 2, 9, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (54, 2, 9, 53);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (55, 2, 9, 54);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (56, 2, 9, 55);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (57, 2, 9, 56);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (58, 2, 10, NULL);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (59, 2, 10, 58);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (60, 2, 10, 59);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (61, 2, 10, 60);

INSERT INTO TAVOLO (CodTavolo, MaxAvventori, Sala, TavoloAdiacente)
VALUES (62, 2, 10, 61);
COMMIT;
/*============================================================================================*/
/*============================================================================================*/
-- Insert per la tabella TAVOLATA
INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (1, TO_DATE('17/11/2021','dd/mm/yyyy'),4,'CA78432DB');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (2, TO_DATE('17/11/2021','dd/mm/yyyy'),5,'CA66421DA');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (3, TO_DATE('18/11/2021','dd/mm/yyyy'),12,'AU0199811');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (4, TO_DATE('18/11/2021','dd/mm/yyyy'),13,'CA64321CE');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (5, TO_DATE('19/11/2021','dd/mm/yyyy'),18,'AU3425442');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (6, TO_DATE('20/11/2021','dd/mm/yyyy'),8,'CA78432DB');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (7, TO_DATE('20/11/2021','dd/mm/yyyy'),25,'CA53216BE');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (8, TO_DATE('22/11/2021','dd/mm/yyyy'),26,'CA73121FE');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (9, TO_DATE('22/11/2021','dd/mm/yyyy'),27,'AU0567231');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (10, TO_DATE('25/11/2021','dd/mm/yyyy'),37,'CA52131PV');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (11, TO_DATE('19/12/2021','dd/mm/yyyy'),26,'CA53216BE');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (12, TO_DATE('20/12/2021','dd/mm/yyyy'),39,'CA87452TB');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (13, TO_DATE('20/12/2021','dd/mm/yyyy'),49,'CA33145OD');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (14, TO_DATE('24/12/2021','dd/mm/yyyy'),50,'AU0236754');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (15, TO_DATE('25/12/2021','dd/mm/yyyy'),53,'CA10946DE');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (16,TO_DATE('25/01/2022','dd/mm/yyyy'),55,'CA33241OA');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (17,TO_DATE('25/01/2022','dd/mm/yyyy'),62,'CA13264UI');

INSERT INTO TAVOLATA (CodTavolata, DataArrivo, Tavolo, Cameriere)
VALUES (18,TO_DATE('25/01/2022','dd/mm/yyyy'),50,'CA13264UI');
COMMIT;
/*===========================================================================================*/
/*===========================================================================================*/
-- Insert per la tabella Avventore
INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('IC3159530','Baldassarre','Pinto',TO_DATE('04/06/1953','dd/mm/yyyy'),'Maschio','Napoli','NA','Napoli','NA','+393493302038','baldassareepinto@gmail.com',35.8,'V',1,1);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('PW824173','Filiberto','Milano',TO_DATE('19/11/1940','dd/mm/yyyy'),'Maschio','Napoli','NA','Napoli','NA','+393598741558','filibertomilano@outlook.com',36.8,'V',1,1);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('WF1996739','Felicita','Piazza',TO_DATE('16/06/1973','dd/mm/yyyy'),'Femmina','Vindoli','RN','Vindoli','RN','+393658942018','felicitaPiazza3@libero.it',36.9,'V',1,2);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('SU2810531','Lea','Barese',TO_DATE('26/07/1985','dd/mm/yyyy'),'Femmina','Cino','SO','Caivano','NA','+393259847862','leaBarese26@gmail.com',36.5,'V',1,2);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('BD8518049','Nazzareno','Onio',TO_DATE('07/12/2001','dd/mm/yyyy'),'Maschio','Badia','VV','Marcianise','CE','+393517788436','nazaon2001@outlook.it',37.0,'V',1,3);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('KT5802431','Edoardo','Ricci',TO_DATE('29/01/2002','dd/mm/yyyy'),'Maschio','Perticani','PG','Benevento','BN','+393254159687','edoRich@libero.it',36.4,'V',1,3);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('WI0726870','Prospero','Padovesi',TO_DATE('24/04/1963','dd/mm/yyyy'),'Maschio','Dorno','PV','Caserta','CE','+393659852014','prPa2404@gmail.com',36.4,'V',1,4);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('CY1881570','Alice','Cocci',TO_DATE('24/05/1951','dd/mm/yyyy'),'Femmina','Calvignasco','MI','Roma','RM','+393654002598','AliceCC@outlook.com',36.2,'V',1,4);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('RT1739919','Quinzio','Pugliesi',TO_DATE('18/05/1989','dd/mm/yyyy'),'Maschio','Ascensione','RA','Recale','CE','+393398947852','QuinzioPugliesi0589@gmail.com',37.0,'F',1,5);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('YS3432289','Ida','Pagnotto',TO_DATE('01/03/1966','dd/mm/yyyy'),'Femmina','Martano','LE','Martano','LE','+393698521655','IdaPagno@gmail.com',36.8,'F',1,5);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('GU1160846','Geronima','Endrizzi',TO_DATE('09/11/2000','dd/mm/yyyy'),'Non specificato','Nago','TN','Vico Equense','NA','+393854759624','GeronimaEnd@gmail.com',35.9,'V',1,6);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('AD8695321','Carolina','Pugliese',TO_DATE('07/04/1953','dd/mm/yyyy'),'Femmina','Casavatore','NA','Casoria','NA','+393275273639','CarolinaPugliese@gmail.com',35.4,'V',1,6);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('BG2548759','Marcella','Pezzali',TO_DATE('28/12/1977','dd/mm/yyyy'),'Femmina','Arzano','NA','Arzano','NA','+393732068075','MarcellaPezzali@gmail.com',36.1,'V',2,7);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('GH5632104','Dolores','Zanzi',TO_DATE('18/01/1955','dd/mm/yyyy'),'Femmina','Volla','NA','Cetara','SA','+393380722982','DoloresDePanza@gmail.com',36.4,'V',2,7);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('FR5849625','Fabiola','Mengolo',TO_DATE('19/09/1956','dd/mm/yyyy'),'Femmina','Giffoni Sei Casali','SA','San Giorgio a Cremano','NA','+393416755818','FabiMengolo@gmail.com',36.5,'V',2,8);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('TR5625487','Daniele','Bernardi',TO_DATE('03/12/1959','dd/mm/yyyy'),'Maschio','Cercola','NA','Portici','NA','+393562319517','DaanBernardi@gmail.com',37.1,'V',2,8);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('BR2648058','Carolina','Lombardi',TO_DATE('07/11/1961','dd/mm/yyyy'),'Femmina','Melito di Napoli','NA','Melito di Napoli','NA','+393516530360','CaroLombardi@gmail.com',37.0,'V',2,9);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('LE2615481','Rossana','Filzi',TO_DATE('23/09/1965','dd/mm/yyyy'),'Femmina','Afragola','NA','Montecorvino Pugliano','SA','+393316825631','RossanaFilzi@gmail.com',36.8,'V',2,9);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('ML6215403','Pierluigi','Trapanese',TO_DATE('30/09/1965','dd/mm/yyyy'),'Maschio','Casandrino','NA','Fisciano','SA','+393303659368','LuigiTrapanese@gmail.com',36.8,'V',2,10);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('RS4697315','Silvia','Golgi',TO_DATE('22/04/1968','dd/mm/yyyy'),'Femmina','Casalnuovo di Napoli','NA','Calvanico','SA','+393869408344','SilviGolgi@gmail.com',36.6,'V',2,10);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('GC9674582','Nicola','Ricci',TO_DATE('21/08/1969','dd/mm/yyyy'),'Maschio','Bellizzi','SA','San Sebastiano al Vesuvio','NA','+393362582808','NicoRic@gmail.com',36.5,'V',2,10);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('AE6164595','Antonio','Bettoni',TO_DATE('20/08/1971','dd/mm/yyyy'),'Maschio','Mugnano di Napoli','NA','Mercato San Severino','SA','+393410197804','AntoBet@gmail.com',36.3,'V',2,10);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('PO3031697','Amleto','Virgilio',TO_DATE('05/01/1975','dd/mm/yyyy'),'Maschio','Marano di Napoli','NA','Maiori','SA','+393488969310','AmletoVirgilio@gmail.com',36.2,'V',2,11);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('MR9748683','Mauro','Priuli',TO_DATE('15/04/1988','dd/mm/yyyy'),'Maschio','Marano di Napoli','NA','Marano di Napoli','NA','+393394922230','MauroPriuli@gmail.com',36.2,'V',2,11);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('DR0301264','Rosaria','Argurio',TO_DATE('25/05/1976','dd/mm/yyyy'),'Femmina','Dugenta','BN','Durazzano','BN','+393250404211','RosiArgurio@gmail.com',36.5,'V',3,12);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('LZ9575684','Mauro','Zola',TO_DATE('17/10/1979','dd/mm/yyyy'),'Maschio','Bellona','CE','Arienzo','CE','+393411767562','MauroZola@gmail.com',36.5,'V',3,12);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('IC2558319','Donatello','Pellegrini',TO_DATE('19/03/1980','dd/mm/yyyy'),'Maschio','Vitulazio','CE','Vitulazio','CE','+393397508638','DonaPellegrini@gmail.com',37.0,'V',3,12);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('TE0864370','Giancarlo','Boitani',TO_DATE('05/04/1982','dd/mm/yyyy'),'Maschio','Cervino','CE','San Felice a Cancello','CE','+393416061365','GianBoitani@gmail.com',37.0,'V',3,12);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('ZO6283162','Melania','Poerio',TO_DATE('23/04/1984','dd/mm/yyyy'),'Femmina','Santa Maria a Vico','CE','Santa Maria la Fossa','CE','+393533370100','MelaniaPoerio@gmail.com',36.7,'V',3,12);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('IH2648039','Renata','Pizzetti',TO_DATE('11/11/1985','dd/mm/yyyy'),'Femmina','Piana di Monte Verna','CE','Piana di Monte Verna','CE','+393516025201','RenataPizz@gmail.com',36.7,'V',3,13);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('FU2645786','Giuseppina','Giannuzzi',TO_DATE('20/07/1990','dd/mm/yyyy'),'Femmina','Grazzanise','CE','Grazzanise','CE','+393520418674','GeppyGianni@gmail.com',36.3,'V',3,13);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('UR6437280','Angelica','Barbarigo',TO_DATE('02/07/1991','dd/mm/yyyy'),'Femmina','San Tammaro','CE','Santa Maria Capua Vetere','CE','+393510895615','LikaBarbagio@gmail.com',36.3,'V',3,14);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('OG6407351','Melissa','Tasso',TO_DATE('16/08/1992','dd/mm/yyyy'),'Femmina','Santa Maria Capua Vetere','CE','Caiazzo','CE','+393309496253','MeliTasso@gmail.com',36.4,'V',3,14);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('OG6427318','Gianluca','Murri',TO_DATE('19/05/1995','dd/mm/yyyy'),'Maschio','Marcianise','CE','Marcianise','CE','+393528831547','GianMurri@gmail.com',36.5,'F',3,15);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('LR9137648','Jolanda','Adinolfi',TO_DATE('06/05/1996','dd/mm/yyyy'),'Femmina','Portico di Caserta','CE','Macerata Campania','CE','+393519447992','JoleAdi@gmail.com',37.0,'F',3,15);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('HE5467974','Fernando','Cilibrasi',TO_DATE('19/07/1997','dd/mm/yyyy'),'Maschio','Pozzuoli','NA','Pozzuoli','NA','+393342696918','FernandoCilibrasi@gmail.com',36.5,'F',3,16);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('TR9746286','Roberto','Camanni',TO_DATE('24/11/1998','dd/mm/yyyy'),'Maschio','Quarto','NA','Quarto','NA','+393438255310','RobiCamanni@gmail.com',36.4,'F',3,16);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('IT3146975','Carmelo','Mastroianni',TO_DATE('12/02/1999','dd/mm/yyyy'),'Maschio','Cardito','NA','Curti','CE','+393309290526','CarmeloMastroianni@gmail.com',36.5,'F',3,17);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('HY9746580','Ezio','Ammaniti',TO_DATE('11/12/2001','dd/mm/yyyy'),'Maschio','Frattamaggiore','NA','Frattamaggiore','NA','+393353722101','EzioAmm@gmail.com',36.8,'F',3,17);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('LH9137684','Aria','Moschino',TO_DATE('02/05/2002','dd/mm/yyyy'),'Femmina','Capodrise','CE','Massa di Somma','NA','+393301539510','AriMoschino@gmail.com',36.7,'V',3,18);

INSERT INTO AVVENTORE (NumCid, Nome, Cognome, DataN, Sesso, CittaN, ProvN, CittaRes, ProvRes, Telefono, Email, Temperatura, HaGreenpass, Ristorante, Tavolata)
VALUES('GE9197735','Vittorio','Pulci',TO_DATE('10/12/2002','dd/mm/yyyy'),'Maschio','Grumo Nevano','NA','Casapulla','CE','+393273531946','VikPulci@gmail.com',36.5,'V',3,18);
COMMIT;
/*===========================================================================================*/
/*===========================================================================================*/
-- Insert per la tabella CASO
INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(1,TO_DATE('25/01/2022','dd/mm/yyyy'),'NonRisolto',NULL,'IC3159530',NULL,1,NULL);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(2,TO_DATE('25/01/2022','dd/mm/yyyy'),'NonRisolto',NULL,'SU2810531',NULL,1,NULL);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(3,TO_DATE('25/01/2022','dd/mm/yyyy'),'NonRisolto',NULL,'RT1739919',NULL,1,NULL);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(4,TO_DATE('25/01/2022','dd/mm/yyyy'),'InRisoluzione',NULL,'LE2615481',NULL,NULL,1);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(5,TO_DATE('25/01/2022','dd/mm/yyyy'),'NonRisolto',NULL,'LZ9575684',NULL,NULL,2);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(6,TO_DATE('25/01/2022','dd/mm/yyyy'),'NonRisolto',NULL,'OG6427318',NULL,NULL,2);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(7,TO_DATE('25/01/2022','dd/mm/yyyy'),'Risolto',NULL,'GE9197735',NULL,NULL,2);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(8,TO_DATE('25/01/2022','dd/mm/yyyy'),'NonRisolto',NULL,NULL,'CA78432DB',1,NULL);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(9,TO_DATE('25/01/2022','dd/mm/yyyy'),'NonRisolto',NULL,NULL,'CA33241OA',NULL,2);

INSERT INTO CASO (CodCaso, DataRegistrazione, StatoCaso, Note, AvventorePositivo, CamerierePositivo, RegistraProprietario, RegistraManager)
VALUES(10,TO_DATE('25/01/2022','dd/mm/yyyy'),'NonRisolto',NULL,NULL,'CA66421DA',1,NULL);
COMMIT;
/*===========================================================================================*/
/*===========================================================================================*/
-- QUERY IMPLEMENTATE DA POTER EFFETTUARE SUL DB 
 
-- 1.Numero giornaliero di avventori per ristorante
-- Supponiamo che il ristorante dato abbia CodRistorante = 1 e la DataArrivo = '17/11/2021'.
SELECT R.Denominazione AS RISTORANTE, T.DataArrivo AS DATA, COUNT(A.NumCid) AS TOT_GIORNALIERO_AVVENTORI
FROM Avventore A JOIN Tavolata T ON A.Tavolata = T.CodTavolata JOIN RISTORANTE R ON R.CodRistorante = A.Ristorante 
WHERE A.Ristorante = 1 AND T.DataArrivo = TO_DATE('17/11/2021','dd/mm/yyyy')
GROUP BY R.Denominazione, T.DataArrivo;
/*============================================================================================*/
/*============================================================================================*/
-- 2.Numero mensile di avventori per ristorante
-- Supponiamo che il ristorante dato abbia CodRistorante = 1 e il mese di riferimento sia 11/2021
SELECT R.Denominazione AS RISTORANTE, TO_CHAR(T.DataArrivo, 'mm  ') AS MESE, TO_CHAR(T.DataArrivo, 'yyyy') AS ANNO, COUNT(A.NumCid) AS TOT_MENSILE_AVVENTORI
FROM AVVENTORE A JOIN TAVOLATA T ON A.Tavolata = T.CodTavolata JOIN RISTORANTE R ON R.CodRistorante = A.Ristorante
WHERE A.Ristorante = 1 AND TO_CHAR(T.DataArrivo,'yyyy') = 2021 AND TO_CHAR(T.DataArrivo,'mm') = 11
GROUP BY R.Denominazione, TO_CHAR(T.DataArrivo,'mm  '),TO_CHAR(T.DataArrivo,'yyyy');
/*============================================================================================*/
/*============================================================================================*/
-- 3.Numero giornaliero di avventori per tutti i ristoranti di un proprietario
-- Supponiamo che il proprietario abbia CodProprietario = 1 e la DataArrivo = '17/11/2021'
SELECT R.Proprietario, T.DataArrivo AS DATA, COUNT(A.NumCid) AS TOT_GIORNALIERO_AVVENTORI_RISTORANTI
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN TAVOLATA T ON A.Tavolata = T.CodTavolata
WHERE R.Proprietario = 1 AND T.DataArrivo = TO_DATE('17/11/2021','dd/mm/yyyy')
GROUP BY R.Proprietario, T.DataArrivo;
/*============================================================================================*/
/*============================================================================================*/
-- 4.Numero mensile di avventori per tutti i ristoranti di un proprietario	
-- Supponiamo che il proprietario abbia CodProprietario = 1 e il 
SELECT R.Proprietario, TO_CHAR(T.DataArrivo, 'mm  ') AS MESE, TO_CHAR(T.DataArrivo, 'yyyy') AS ANNO, COUNT(A.NumCid) AS TOT_MENSILE_AVVENTORI_RISTORANTI
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN TAVOLATA T ON A.Tavolata = T.CodTavolata
WHERE R.Proprietario = 1 AND TO_CHAR(T.DataArrivo,'mm') = 11 AND TO_CHAR(T.DataArrivo, 'yyyy') = 2021 
GROUP BY R.Proprietario, TO_CHAR(T.DataArrivo,'mm  '),TO_CHAR(T.DataArrivo,'yyyy');
/*============================================================================================*/
/*============================================================================================*/
-- 5.Casi positivi di un determinato ristorante per data di arrivo della tavolata
-- Supponiamo che il codice del ristorante sia CodRistorante = 1 e che la data di arrivo della tavolata sia il: '17/11/2021'
SELECT R.Denominazione AS RISTORANTE, T.DataArrivo AS DATA_ARV, COUNT(C.AvventorePositivo) TOT_RISULTATI_POSITIVI
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN TAVOLATA T ON T.CodTavolata = A.Tavolata JOIN CASO C ON C.AvventorePositivo = A.NumCid 
WHERE A.Ristorante = 1 AND T.DataArrivo = TO_DATE('17/11/2021','dd/mm/yyyy')
GROUP BY R.Denominazione, T.DataArrivo;
/*============================================================================================*/
/*============================================================================================*/
-- 6.Casi positivi di un determinato ristorante per mese di arrivo della tavolata
-- Supponiamo che il codice del ristorante sia CodRistorante = 1 e che il mese di arrivo della tavolata sia 11/2021
SELECT R.Denominazione AS RISTORANTE, TO_CHAR(T.DataArrivo, 'mm  ') AS MESE, TO_CHAR(T.DataArrivo, 'yyyy') AS ANNO, COUNT(C.AvventorePositivo) TOT_RISULTATI_POSITIVI
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN TAVOLATA T ON T.CodTavolata = A.Tavolata JOIN CASO C ON C.AvventorePositivo = A.NumCid 
WHERE A.Ristorante = 1 AND TO_CHAR(T.DataArrivo,'mm') = 11 AND TO_CHAR(T.DataArrivo, 'yyyy') = 2021 
GROUP BY R.Denominazione, TO_CHAR(T.DataArrivo, 'mm  '), TO_CHAR(T.DataArrivo, 'yyyy');
/*============================================================================================*/
/*============================================================================================*/
-- 7.Casi positivi di un determinato ristorante per anno di arrivo della tavolata
-- Supponiamo che il codice del ristorante sia CodRistorante = 1 e che l'anno di arrivo della tavolata sia il 2021
SELECT R.Denominazione AS RISTORANTE, TO_CHAR(T.DataArrivo, 'yyyy') AS ANNO, COUNT(C.AvventorePositivo) TOT_RISULTATI_POSITIVI
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN TAVOLATA T ON T.CodTavolata = A.Tavolata JOIN CASO C ON C.AvventorePositivo = A.NumCid 
WHERE A.Ristorante = 1 AND TO_CHAR(T.DataArrivo, 'yyyy') = 2021 
GROUP BY R.Denominazione, TO_CHAR(T.DataArrivo, 'yyyy');
/*============================================================================================*/
/*============================================================================================*/
-- 8.Casi positivi di tutti i ristoranti di un proprietario per data di arrivo della tavolata
-- Supponiamo che il codice del proprietario sia CodProprietario = 1 e che la data di arrivo della tavolata sia il: '17/11/2021'
SELECT R.Proprietario, T.DataArrivo AS DATA_ARV, COUNT(C.AvventorePositivo) TOT_RISULTATI_POSITIVI_RISTORANTI
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN TAVOLATA T ON T.CodTavolata = A.Tavolata JOIN CASO C ON C.AvventorePositivo = A.NumCid 
WHERE R.Proprietario = 1 AND T.DataArrivo = TO_DATE('17/11/2021','dd/mm/yyyy')
GROUP BY R.Proprietario, T.DataArrivo;
/*============================================================================================*/
/*============================================================================================*/
-- 9.Casi positivi di tutti i ristoranti di un proprietario per mese di arrivo della tavolata 
-- Supponiamo che il codice del proprietario sia CodProprietario = 1 e che il mese di arrivo della tavolata sia 11/2021
SELECT R.Proprietario, TO_CHAR(T.DataArrivo, 'mm  ') AS MESE, TO_CHAR(T.DataArrivo, 'yyyy') AS ANNO, COUNT(C.AvventorePositivo) TOT_RISULTATI_POSITIVI_RISTORANTI
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN TAVOLATA T ON T.CodTavolata = A.Tavolata JOIN CASO C ON C.AvventorePositivo = A.NumCid 
WHERE R.Proprietario = 1 AND TO_CHAR(T.DataArrivo,'mm') = 11 AND TO_CHAR(T.DataArrivo, 'yyyy') = 2021 
GROUP BY R.Proprietario, TO_CHAR(T.DataArrivo, 'mm  '), TO_CHAR(T.DataArrivo, 'yyyy');
/*============================================================================================*/
/*============================================================================================*/
-- 10.Casi positivi di tutti i ristoranti di un proprietario per mese di arrivo della tavolata 
-- Supponiamo che il codice del proprietario sia CodProprietario = 1 e che l'anno di arrivo della tavolata sia il 2021
SELECT R.Proprietario, TO_CHAR(T.DataArrivo, 'yyyy') AS ANNO, COUNT(C.AvventorePositivo) TOT_RISULTATI_POSITIVI_RISTORANTI
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN TAVOLATA T ON T.CodTavolata = A.Tavolata JOIN CASO C ON C.AvventorePositivo = A.NumCid 
WHERE R.Proprietario = 1 AND TO_CHAR(T.DataArrivo, 'yyyy') = 2021 
GROUP BY R.Proprietario, TO_CHAR(T.DataArrivo, 'yyyy');
/*============================================================================================*/
/*============================================================================================*/
-- 11.Informazioni sugli avventori risultati positivi in un ristorante
-- Supponiamo che il codice del ristorante che ha accolto gli avventori risultati positivi sia CodRistorante = 1
SELECT C.CodCaso, C.DataRegistrazione AS DATAR, CAST(R.Denominazione AS VARCHAR2(20)) AS RISTORANTE, A.NumCid, CAST(A.Nome AS VARCHAR2(30)) AS Nome, 
CAST(A.Cognome AS VARCHAR2(30)) AS Cognome, A.DataN, A.Telefono, A.HaGreenpass AS G , T.CodTavolata, T.DataArrivo, T.Cameriere, T.Tavolo, TA.TavoloAdiacente 
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN CASO C ON C.AvventorePositivo = A.NumCid 
				  JOIN TAVOLATA T ON T.CodTavolata = A.Tavolata JOIN TAVOLO TA ON TA.CodTavolo = T.Tavolo
WHERE A.Ristorante = 1
ORDER BY C.CodCaso;
/*============================================================================================*/
/*============================================================================================*/
-- 12.Informazioni sugli avventori risultati positivi in un ristorante
-- Supponiamo che il codice del proprietario dei ristoranti sia CodProprietario = 1
SELECT C.CodCaso, C.DataRegistrazione AS DATAR, CAST(R.Denominazione AS VARCHAR2(20)) AS RISTORANTE, A.NumCid, CAST(A.Nome AS VARCHAR2(30)) AS Nome, 
CAST(A.Cognome AS VARCHAR2(30)) AS Cognome, A.DataN, A.Telefono, A.HaGreenpass AS G , T.CodTavolata, T.DataArrivo, T.Cameriere, T.Tavolo, TA.TavoloAdiacente 
FROM RISTORANTE R JOIN AVVENTORE A ON R.CodRistorante = A.Ristorante JOIN CASO C ON C.AvventorePositivo = A.NumCid 
				  JOIN TAVOLATA T ON T.CodTavolata = A.Tavolata JOIN TAVOLO TA ON TA.CodTavolo = T.Tavolo
WHERE R.Proprietario = 1
ORDER BY C.CodCaso;
/*============================================================================================*/
/*============================================================================================*/
-- 13.Informazioni sui camerieri risultati positivi in un ristorante
-- Supponiamo che il codice del ristorante per cui lavorano i camerieri risultati positivi sia CodRistorante = 1
SELECT CA.CodCaso, CA.DataRegistrazione AS DATAR, CAST(R.Denominazione AS VARCHAR2(20)) AS RISTORANTE, C.NumCid, CAST(C.Nome AS VARCHAR2(30)) AS Nome, 
CAST(C.Cognome AS VARCHAR2(30)) AS Cognome, C.DataN, C.Telefono
FROM RISTORANTE R JOIN CAMERIERE C ON R.CodRistorante = C.Ristorante JOIN CASO CA ON CA.CamerierePositivo = C.NumCid 
WHERE C.Ristorante = 1
ORDER BY CA.CodCaso;
/*============================================================================================*/
/*============================================================================================*/
-- 14.Informazioni sui camerieri risultati positivi in tutti i ristoranti di un proprietario 
-- Supponiamo che il codice del proprietario dei ristoranti sia CodProprietario = 1
SELECT CA.CodCaso, CA.DataRegistrazione AS DATAR, CAST(R.Denominazione AS VARCHAR2(20)) AS RISTORANTE, C.NumCid, CAST(C.Nome AS VARCHAR2(30)) AS Nome, 
CAST(C.Cognome AS VARCHAR2(30)) AS Cognome, C.DataN, C.Telefono
FROM RISTORANTE R JOIN CAMERIERE C ON R.CodRistorante = C.Ristorante JOIN CASO CA ON CA.CamerierePositivo = C.NumCid 
WHERE R.Proprietario = 1
ORDER BY CA.CodCaso;
/*============================================================================================*/
/*============================================================================================*/
-- 15.Avventori positivi con o senza green pass 
SELECT COUNT(C.CodCaso) AS AVVENTORI_POSITIVI_CON_GREENPASS
FROM CASO C JOIN AVVENTORE A ON C.AvventorePositivo = A.NumCid 
WHERE A.HaGreenpass='V';

SELECT COUNT(C.CodCaso) AS AVVENTORI_POSITIVI_SENZA_GREENPASS
FROM CASO C JOIN AVVENTORE A ON C.AvventorePositivo = A.NumCid 
WHERE A.HaGreenpass='F';
/*============================================================================================*/
/*============================================================================================*/
-- 16.Numero di avventori medio per tavolata di un ristorante 
-- Supponendo di voler conoscere la media di avventori per tavolata del ristorante di CodRistorante = 2
SELECT T.Ristorante, AVG(T.Partecipanti) AS MEDIA_AVVENTORI_PER_TAVOLATA
FROM TAVOLATE T
WHERE T.Ristorante = 2
GROUP BY T.Ristorante;
/*============================================================================================*/
/*============================================================================================*/